{{- $src := .Src -}}
{{ $image := (.Page.Resources.GetMatch  (index $src)) }}
{{- with dict "Path" .Src "Resources" .Resources | partial "function/resource.html" -}}
    {{- $image = . -}}
{{- end -}}

{{ $resize_optaion := ""}}
{{ $src_set := ""}}
{{ $src_set = (print $image.RelPermalink " " $image.Width "w") }}
{{ $src := $image }}
{{ $x_small := $image }}
{{ $small := $image }}
{{ $medium := $image }}
{{ $large := $image }}
{{ $orientation := 1 }}
{{ with $image.Exif }}
{{ with .Tags }}
{{ with .Orientation }}
{{ $orientation = . }}
{{ end }}
{{ end }}
{{ end }}

{{ if eq $orientation 6 }}
    {{ $resize_optaion = " r270"}}
{{ else if (eq $orientation 8) }}
    {{ $resize_optaion = " r90"}}
{{ end }}


{{ if ge $image.Width "500"}}
{{ $opt := (print "500x" $resize_optaion) }}
{{ $x_small = $image.Resize $opt }}
{{ $src_set = (print $src_set ", "  $x_small.RelPermalink " 500w") }}
{{ end }}

{{ if ge $image.Width "800"}}
{{ $opt := (print "800x" $resize_optaion) }}
{{ $small = $image.Resize $opt }}
{{ $src_set = (print $src_set ", " $small.RelPermalink " 800w") }}
{{ end }}

{{ if ge $image.Width "1200"}}
{{ $opt := (print "1200x" $resize_optaion) }}
{{ $medium = $image.Resize $opt }}
{{ $src_set = (print $src_set ", " $medium.RelPermalink " 1200w") }}
{{ end }}

{{ if gt $image.Width "1500"}}
{{ $opt := (print "1500x" $resize_optaion) }}
{{ $large = $image.Resize $opt }}
{{ $src_set = (print $src_set ", " $large.RelPermalink " 1500w") }}
{{ end }}
{{- $alt := .Alt | default $large.RelPermalink -}}
{{- $loading := resources.Get "svg/loading.svg" | minify -}}
    <a class="lightgallery" data-srcset="{{ $src_set }}" href="{{ $large.RelPermalink | safeURL }}" title="{{ .Title | default $alt }}" data-thumbnail="{{ $large.RelPermalink | safeURL }}"{{ with .Caption }} data-sub-html="<h2>{{ . }}</h2>{{ with $.Title }}<p>{{ . }}</p>{{ end }}"{{ end }}{{ with .Rel }} rel="{{ . }}"{{ end }}>
    <img
        class="lazyload{{ with .Class }} {{ . }}{{ end }}"
        src="{{ $loading.RelPermalink }}"
        data-src="{{ $large.RelPermalink | safeURL }}"
        data-srcset="{{ $src_set }}"
        data-sizes="auto"
        alt="{{ $alt }}"{{ with .Height }} height="{{ . }}"{{ end }}{{ with .Width }} width="{{ . }}"{{ end }} />
    </a>

